#!/usr/bin/env perl
use 5.36.0;

use lib 'lib';

use Getopt::Long::Descriptive;
use Synergy::VestaUtil;

use utf8;

binmode *STDOUT, 'encoding(UTF-8)';

my ($opt, $usage) = describe_options(
  '%c %o',
  [ 'img', 'fetch image and show it with imgcat' ],
);

my $input  = $ARGV[0];

$input =~ s/\\r/ğŸŸ¥/g;
$input =~ s/\\o/ğŸŸ§/g;
$input =~ s/\\y/ğŸŸ¨/g;
$input =~ s/\\g/ğŸŸ©/g;
$input =~ s/\\b/ğŸŸ¦/g;
$input =~ s/\\p/ğŸŸª/g;
$input =~ s/\\w/â¬œ/g;

my ($board, $err) = Synergy::VestaUtil->text_to_board($input);

die "Problem with input: $err\n" if $err;

my $string = Synergy::VestaUtil->encode_board($board);
my $show   = Synergy::VestaUtil->board_to_text($board);

my $url = sprintf "http://s.yner.gy:8111/%s", $string;

$show =~ s/^/â”‚ /gm;
$show =~ s/$/ â”‚/gm;

say "â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®";
say $show;
say "â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯";
say $url;

if ($opt->img) {
  say `bash -c "curl -s $url | imgcat"`;
}

1;
